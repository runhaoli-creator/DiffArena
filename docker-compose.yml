# SPDX-FileCopyrightText: Copyright (c) 2025 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Docker Compose configuration for Cosmos-Transfer2.5
# Makes it easier to manage the container with docker-compose

version: '3.8'

services:
  cosmos-transfer2.5:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - TARGETPLATFORM=linux/amd64
    image: cosmos-transfer2.5:latest
    container_name: cosmos-transfer2.5
    volumes:
      # Mount current directory to /workspace
      - .:/workspace
      # Named volume for .venv to persist across container restarts
      - cosmos-transfer2.5-venv:/workspace/.venv
    working_dir: /workspace
    # GPU support (requires nvidia-docker2)
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    # Environment variables
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - PYTHONUNBUFFERED=1
      # Enable learnable noise for testing
      - LEARN_NOISE=1
    # Keep container running
    stdin_open: true
    tty: true
    # Command to run (default: bash)
    command: /bin/bash

volumes:
  cosmos-transfer2.5-venv:
    driver: local


